"""Промпты для проактивного планирования и отчётов."""

from __future__ import annotations

from datetime import datetime


def _thoughts_block(user_thoughts: str | None) -> str:
    """Блок с мыслями пользователя для вставки в промпт."""
    if not user_thoughts:
        return ""
    return (
        f"\n\nМои приоритеты и мысли:\n{user_thoughts}\n\n"
        f"Учти это при составлении плана."
    )


def daily_plan_prompt(
    project_display_name: str,
    today: datetime,
    user_thoughts: str | None = None,
) -> str:
    """Промпт для утреннего плана дня."""
    weekday_ru = {
        0: "понедельник", 1: "вторник", 2: "среда",
        3: "четверг", 4: "пятница", 5: "суббота", 6: "воскресенье",
    }
    day_name = weekday_ru.get(today.weekday(), "")
    date_str = today.strftime("%d.%m.%Y")

    return (
        f"Составь план на сегодня ({day_name}, {date_str}) для проекта {project_display_name}.\n\n"
        f"Для этого:\n"
        f"1. Проверь календарь на сегодня — какие встречи и события запланированы\n"
        f"2. Проверь свежие входящие письма за последние 24 часа — есть ли срочные\n"
        f"3. Если есть Slack — проверь непрочитанные сообщения\n\n"
        f"На основе собранных данных составь краткий план дня:\n"
        f"- Встречи и события с временем\n"
        f"- Срочные письма, требующие ответа\n"
        f"- Рекомендации по приоритетам\n\n"
        f"Формат: краткий, структурированный, читаемый за 1 минуту."
        + _thoughts_block(user_thoughts)
    )


def weekly_plan_prompt(
    project_display_name: str,
    today: datetime,
    user_thoughts: str | None = None,
) -> str:
    """Промпт для плана на неделю (понедельник утром)."""
    date_str = today.strftime("%d.%m.%Y")

    return (
        f"Составь план на эту неделю (начиная с {date_str}) для проекта {project_display_name}.\n\n"
        f"Для этого:\n"
        f"1. Проверь календарь на всю неделю — все встречи и события\n"
        f"2. Проверь входящие письма за последние 3 дня — что ожидает ответа\n"
        f"3. Если есть Slack — проверь важные сообщения\n\n"
        f"Составь обзор недели:\n"
        f"- Ключевые встречи и дедлайны по дням\n"
        f"- Письма и задачи, ожидающие действий\n"
        f"- Рекомендации по приоритетам на неделю\n\n"
        f"Формат: краткий, структурированный, читаемый за 2 минуты."
        + _thoughts_block(user_thoughts)
    )


def weekly_report_prompt(
    project_display_name: str,
    today: datetime,
    user_thoughts: str | None = None,
) -> str:
    """Промпт для еженедельного отчёта."""
    date_str = today.strftime("%d.%m.%Y")

    return (
        f"Составь отчёт за прошедшую неделю (на {date_str}) по проекту {project_display_name}.\n\n"
        f"Для этого:\n"
        f"1. Проверь отправленные письма за последние 7 дней — что было сделано\n"
        f"2. Проверь календарь за прошедшую неделю — какие встречи состоялись\n"
        f"3. Проверь входящие письма за 7 дней — ключевые переписки\n"
        f"4. Если есть Slack — основные обсуждения за неделю\n\n"
        f"Составь отчёт:\n"
        f"- Ключевые действия и результаты\n"
        f"- Состоявшиеся встречи и их итоги\n"
        f"- Важные переписки и решения\n"
        f"- Открытые вопросы и follow-up\n"
        f"- Планы на следующую неделю\n\n"
        f"Формат: краткий, структурированный, читаемый за 3 минуты. "
        f"Акцент на конкретных действиях и результатах."
        + _thoughts_block(user_thoughts)
    )
